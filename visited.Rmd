---
title: "Visited Places with Images"
output: 
  html_document:
    self_contained: false
    theme: flatly
    toc: true
    toc_float: true
output_dir: "docs"
---

```{r setup, include=FALSE}
# Load required libraries
library(mapview)
library(sf)
library(readr)
library(dplyr)
library(htmltools)
library(webshot2)



# Step 1: Read CSV
places <- read_csv("places.csv", locale = locale(encoding = "UTF-8"))

# Step 2: Create popup HTML
places$popup <- paste0(
  "<img src='Images/places/", places$filename, 
  "' width='220px' style='border-radius:10px;margin-bottom:5px;'><br><b>",
  places$desc, "</b>"
)

# Step 3: Convert to spatial object (sf)
places_sf <- st_as_sf(places, coords = c("lng", "lat"), crs = 4326)



# Step 4: Copy images to docs folder
dir.create("docs/Images/places", recursive = TRUE, showWarnings = FALSE)
img_files <- list.files("Images/places", full.names = TRUE, pattern = "\\.(jpg|jpeg|png)$", ignore.case = TRUE)
file.copy(img_files, "docs/Images/places", overwrite = TRUE)


# Step 5: Create the map with mapview
map <- mapview(
  places_sf,
  popup = places$popup,
  layer.name = "Visited Places",
  homebutton = TRUE
)

map



